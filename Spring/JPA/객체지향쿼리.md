# ê°ì²´ì§€í–¥ì¿¼ë¦¬

# ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´

## ğŸ¥ŸJPQL

- JPAë¥¼ ì‚¬ìš©í•˜ë©´ ì—”í‹°í‹° ê°ì²´ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ê°œë°œ
- ê²€ìƒ‰ ì¿¼ë¦¬ê°€ ë¬¸ì œ..
- SQLì„ ì¶”ìƒí™”í•œ ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ ì œê³µ
- SQLì€ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì„ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬
- JPQLì€ ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬

```java
//ì—”í‹°í‹°ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì‹¤í–‰ m== ì—”í‹°í‹° ìì²´ë¥¼ ì¡°íšŒí•´ë¼!! , ë™ì ì¿¼ë¦¬ë¥¼ ì§œê¸°ì—ëŠ” ë¶ˆí¸í•˜ë‹¤
//MybatisëŠ” ë™ì ì¿¼ë¦¬ê°€ ëŒ€ì²´ì ìœ¼ë¡œ í¸í•˜ë‹¤.
List<Member> result=em.createQuery("select m from Member m where m.username like '%kim%'",Member.class)
        .getResultList();
```

## ğŸ’¨JPA Criteria

```java
//Criteria ì‚¬ìš© ì¤€ë¹„ ì•Œì•„ë³´ê¸°ê°€ í˜ë“¤ë‹¤... ë™ì ì¿¼ë¦¬ëŠ” ì‚¬ìš©í•˜ê¸°ëŠ” í¸í•˜ë‹¤..
CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<Member> query = cb.createQuery(Member.class);
//ë£¨íŠ¸ í´ë˜ìŠ¤ (ì¡°íšŒë¥¼ ì‹œì‘í•  í´ë˜ìŠ¤)
Root<Member> m = query.from(Member.class);
//ì¿¼ë¦¬ ìƒì„±
CriteriaQuery<Member> cq = query.select(m).where(cb.equal(m.get("username"), â€œkimâ€));
List<Member> resultList = em.createQuery(cq).getResultList();
```

- ë‹¨ì  : ë„ˆë¬´ ë³µì¡í•˜ê³  ì‹¤ìš©ì„±ì´ ì—†ë‹¤
- ë¬¸ìê°€ ì•„ë‹Œ ìë°”ì½”ë“œë¡œ JPQL ì‘ì„±

## QueryDSL

- ë¬¸ìê°€ ì•„ë‹Œ ìë°”ì½”ë“œë¡œ JPQL ì‘ì„±
- ì»´íŒŒì¼ ì‹œì ì— ë¬¸ë²• ì˜¤ë¥˜ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŒ
- ë™ì ì¿¼ë¦¬ ì‘ì„± í¸ë¦¬í•¨
- ë‹¨ìˆœí•˜ê³  ì‰¬ì›€

```java
//JPQL 
//select m from Member m where m.age > 18
JPAFactoryQuery query = new JPAQueryFactory(em);
QMember m = QMember.member; 

List<Member> list = 
query.selectFrom(m)
.where(m.age.gt(18)) 
.orderBy(m.name.desc())
.fetch();
```

## ë„¤ì´í‹°ë¸Œ SQL

- JPAê°€ ì œê³µí•˜ëŠ” SQLì„ ì§ì ‘ ì‚¬ìš©
- JPQLë¡œ í•´ê²°í•  ìˆ˜ ì—†ëŠ” íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ì— ì˜ì¡´ì ì¸ ê¸°ëŠ¥

```java
String sql = 
 â€œSELECT ID, AGE, TEAM_ID, NAME FROM MEMBER WHERE NAME = â€˜kimâ€™"; 
List<Member> resultList = 
 em.createNativeQuery(sql, Member.class).getResultList();
```

## JDBC API ì§ì ‘ì‚¬ìš©

- JPAë¥¼ ì‚¬ìš©í•˜ë©´ì„œ JDBC ì»¤ë„¥ì…˜ì„ ì§ì ‘ ì‚¬ìš©í•˜ê±°ë‚˜, ìŠ¤í”„ë§
JdbcTemplate, ë§ˆì´ë°”í‹°ìŠ¤ë“±ì„ í•¨ê»˜ ì‚¬ìš© ê°€ëŠ¥
- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì ì ˆí•œ ì‹œì ì— ê°•ì œë¡œ í”ŒëŸ¬ì‹œ í•„ìš”

# JPQL

## ë¬¸ë²•

![./JPA09/JPA.png](./JPA09/JPA.png)

- ì—”í‹°í‹°ì™€ ì†ì„±ì€ ëŒ€ì†Œë¬¸ì êµ¬ë¶„ O
- JPQL í‚¤ì›Œë“œëŠ” ëŒ€ì†Œë¬¸ì êµ¬ë¶„ X(SELECT, from, where)
- ì—”í‹°í‹° ì´ë¦„ ì‚¬ìš©
- ë³„ì¹­ì€ í•„ìˆ˜

## TypeQuery,Query

- TypeQuery : ë°˜í™˜ íƒ€ì…ì´ ëª…í™•í•  ë•Œ ì‚¬ìš©
- Query: ë°˜í™˜ íƒ€ì…ì´ ëª…í™•í•˜ì§€ ì•Šì„ ë•Œ ì‚¬ìš©
- 

```java
//ë°˜í™˜ íƒ€ì…ì´ ëª…í™•í•  ë•Œ
TypedQuery<Member> query = em.createQuery("select m from Member m", Member.class);
//ë¦¬í„´ íƒ€ì…ì´ ëª…í™•í•˜ì§€ ì•Šì„ ë•Œ
Query query2 = em.createQuery("select m.age, m.username from Member m");
```

## ê²°ê³¼ ì¡°íšŒ API

- `query.getResultList()` : ê²°ê³¼ê°€ í•˜ë‚˜ ì´ìƒì¼ ë•Œ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
- `query.getSingleResult()` : ê²°ê³¼ê°€ ì •í™•íˆ í•˜ë‚˜, ë‹¨ì¼ ê°ì²´ ë°˜í™˜

## íŒŒë¼ë¯¸í„° ë°”ì¸ë”©

- ì´ë¦„ ê¸°ì¤€

```java
SELECT m FROM Member m where m.username=:username 
query.setParameter("username", usernameParam);
```

- ìœ„ì¹˜ ê¸°ì¤€

```java
SELECT m FROM Member m where m.username=?1 
query.setParameter(1, usernameParam);
```

- ìœ„ì¹˜ë³´ë‹¤ ì´ë¦„ìœ¼ë¡œ ìì£¼ ì‚¬ìš©í•œë‹¤.

## í”„ë¡œì ì…˜

- select ì ˆì— ì¡°íšŒí•  ëŒ€ìƒì„ ì§€ì •í•˜ëŠ” ê²ƒ
- í”„ë¡œì ì…˜ ëŒ€ìƒ : ì—”í‹°í‹°, ì„ë² ë””ë“œ íƒ€ì…, ìŠ¤ì¹¼ë¼ íƒ€ì…(ê¸°ë³¸ ë°ì´í„° íƒ€ì…)
- DISTINCT ë¡œ ì¤‘ë³µ ì œê±°

### ì—¬ëŸ¬ ê°’ ì¡°íšŒ

- select m.username, m.age from Member m

1. Query íƒ€ì…
2. Object[] íƒ€ì…
3. new ëª…ë ¹ì–´ë¡œ ì¡°íšŒ
    - DTOë¡œ ë°”ë¡œ ì¡°íšŒ
    - íŒ¨í‚¤ì§€ëª…ì„ í¬í•¨í•œ ì „ì²´ í´ë˜ìŠ¤ ëª… ì…ë ¥
    - ìˆœì„œì™€ íƒ€ì…ì´ ì¼ì¹˜í•˜ëŠ” ìƒì„±ì í•„ìš”

## í˜ì´ì§• API

- `setFirstResult ()` : ì¡°íšŒ ì‹œì‘ ìœ„ì¹˜
- `setMaxResults()` : ì¡°íšŒí•  ë°ì´í„° ìˆ˜

```java
//í˜ì´ì§• ì¿¼ë¦¬
 String jpql = "select m from Member m order by m.name desc";
 List<Member> resultList = em.createQuery(jpql, Member.class)
 .setFirstResult(10)
 .setMaxResults
 .getResultList();
```

## ì„œë¸Œ ì¿¼ë¦¬

- JPAëŠ” where, having ì ˆì—ì„œë§Œ ì„œë¸Œ ì¿¼ë¦¬ ì‚¬ìš© ê°€ëŠ¥
- select ì ˆë„ ê°€ëŠ¥
- from ì ˆì—ì„œëŠ” ë¶ˆê°€ëŠ¥

## ê¸°ë³¸ í•¨ìˆ˜

- CONCAT
- SUBSTRING
- RIM
- LOWER, UPPER
- LENGTH
- LOCATE
- ABS, SQRT, MOD
- SIZE, INDEX(JPA ìš©ë„)
